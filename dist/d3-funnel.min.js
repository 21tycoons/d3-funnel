/*! d3-funnel - v0.8.0 | 2016 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):"object"==typeof exports?exports.D3Funnel=e(require("d3")):t.D3Funnel=e(t.d3)}(this,function(t){return function(t){function e(a){if(i[a])return i[a].exports;var n=i[a]={exports:{},id:a,loaded:!1};return t[a].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";t.exports=i(1)["default"]},function(t,e,i){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t},l=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),s=i(2),h=a(s),u=i(3),c=a(u),f=i(4),d=a(f),v=i(5),y=a(v),g=i(6),p=a(g),b=function(){function t(e){r(this,t),this.selector=e,this.colorizer=new c["default"],this.labelFormatter=new d["default"],this.navigator=new y["default"],this.id=null,this.autoId=0,this.onMouseOver=this.onMouseOver.bind(this),this.onMouseOut=this.onMouseOut.bind(this)}return l(t,[{key:"destroy",value:function(){var t=h["default"].select(this.selector);t.selectAll("svg").remove(),t.selectAll("*").remove(),t.text("")}},{key:"draw",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];this.destroy(),this.initialize(t,e),this.drawOntoDom()}},{key:"initialize",value:function(t,e){this.validateData(t);var i=this.getSettings(e);this.id=this.generateUniqueId(),this.colorizer.setInstanceId(this.id),this.label=i.label,this.labelFormatter.setFormat(this.label.format),this.colorizer.setLabelFill(i.label.fill),this.colorizer.setScale(i.block.fill.scale),this.width=i.chart.width,this.height=i.chart.height,this.bottomWidth=i.chart.width*i.chart.bottomWidth,this.bottomPinch=i.chart.bottomPinch,this.isInverted=i.chart.inverted,this.isCurved=i.chart.curve.enabled,this.addValueOverlay=i.block.barOverlay,this.curveHeight=i.chart.curve.height,this.fillType=i.block.fill.type,this.hoverEffects=i.block.highlight,this.dynamicHeight=i.block.dynamicHeight,this.dynamicSlope=i.block.dynamicSlope,this.minHeight=i.block.minHeight,this.animation=i.chart.animate,this.totalCount=i.chart.totalCount,this.onBlockClick=i.events.click.block,this.setBlocks(t),this.bottomLeftX=(this.width-this.bottomWidth)/2,this.dx=this.getDx(),this.dy=this.getDy()}},{key:"validateData",value:function(t){if(Array.isArray(t)===!1)throw new Error("Data must be an array.");if(0===t.length)throw new Error("Data array must contain at least one element.");if(Array.isArray(t[0])===!1)throw new Error("Data array elements must be arrays.");if(t[0].length<2)throw new Error("Data array elements must contain a label and value.")}},{key:"getSettings",value:function(t){var e=this.getContainerDimensions(),i=this.getDefaultSettings(e),a=p["default"].extend({},i);return a=p["default"].extend(a,t),a.chart=o({},a.chart,this.castDimensions(a,e)),a}},{key:"getDefaultSettings",value:function(e){var i=t.defaults;return i.chart=o({},i.chart,e),i}},{key:"getContainerDimensions",value:function(){return{width:parseFloat(h["default"].select(this.selector).style("width")),height:parseFloat(h["default"].select(this.selector).style("height"))}}},{key:"castDimensions",value:function(e,i){var a=e.chart,n={};return["width","height"].forEach(function(e){var r=a[e],o=i[e];/%$/.test(String(r))?n[e]=parseFloat(r)/100*o:0>=r?n[e]=t.defaults.chart[e]:n[e]=r}),n}},{key:"setBlocks",value:function(t){var e=this.getTotalCount(t);this.blocks=this.standardizeData(t,e)}},{key:"getTotalCount",value:function(t){var e=this;if(null!==this.totalCount)return this.totalCount||0;var i=0;return t.forEach(function(t){i+=e.getRawBlockCount(t)}),i}},{key:"standardizeData",value:function(t,e){var i=this,a=[];return t.forEach(function(t,n){var r=i.getRawBlockCount(t),o=r/e||0,l=t[0];a.push({index:n,ratio:o,value:r,height:i.height*o,fill:i.colorizer.getBlockFill(t,n,i.fillType),label:{raw:l,formatted:i.labelFormatter.format(l,t[1]),color:i.colorizer.getLabelFill(t)}})}),a}},{key:"getRawBlockCount",value:function(t){return Array.isArray(t[1])?t[1][0]:t[1]}},{key:"getDx",value:function(){return this.bottomPinch>0?this.bottomLeftX/(this.blocks.length-this.bottomPinch):this.bottomLeftX/this.blocks.length}},{key:"getDy",value:function(){return this.isCurved?(this.height-this.curveHeight)/this.blocks.length:this.height/this.blocks.length}},{key:"drawOntoDom",value:function(){this.svg=h["default"].select(this.selector).append("svg").attr("id",this.id).attr("width",this.width).attr("height",this.height);var t=this.makePaths();this.blockPaths=t[0],this.overlayPaths=t[1],"gradient"===this.fillType&&this.defineColorGradients(this.svg),this.isCurved&&this.drawTopOval(this.svg,this.blockPaths),this.drawBlock(0)}},{key:"generateUniqueId",value:function(){for(var t=!0,e="";t;)e="d3-funnel-chart-"+this.autoId,null===document.getElementById(e)&&(t=!1),this.autoId++;return e}},{key:"makePaths",value:function(){var t=this,e=[],i=[],a=this.dx,r=this.dy,o=0,l=this.width,s=0;this.isInverted&&(o=this.bottomLeftX,l=this.width-this.bottomLeftX);var h=0,u=0,c=0,f=this.width/2;this.isCurved&&(s=10);var d=this.height;0!==this.minHeight&&(d=this.height-this.minHeight*this.blocks.length);var v=this.height;this.blocks.forEach(function(e,i){t.bottomPinch>0&&(t.isInverted?i<t.bottomPinch&&(v-=e.height):i>=t.blocks.length-t.bottomPinch&&(v-=e.height))});var y=2*v/(this.width-this.bottomWidth);return this.blocks.forEach(function(v,g){if(t.dynamicHeight&&(r=d*v.ratio,0!==t.minHeight&&(r+=t.minHeight),t.isCurved&&(r-=t.curveHeight/t.blocks.length),h=(s+r)/y,t.isInverted&&(h=(s+r-t.height)/(-1*y)),0===t.bottomWidth&&g===t.blocks.length-1&&(h=t.width/2,t.isInverted&&(h=0)),t.bottomWidth===t.width&&(h=o),a=h-o,t.isInverted&&(a=o-h)),t.dynamicSlope){var p=t.blocks[g+1]?t.blocks[g+1].value:v.value,b=1-p/v.value;a=b*(f-o)}t.bottomPinch>0&&(t.isInverted?(t.dynamicHeight||(a=t.dx),a=g<t.bottomPinch?0:a):g>=t.blocks.length-t.bottomPinch&&(a=0)),h=o+a,u=l-a,c=s+r,t.isInverted&&(h=o-a,u=l+a);var k={centerX:f,prevLeftX:o,prevRightX:l,prevHeight:s,nextLeftX:h,nextRightX:u,nextHeight:c,curveHeight:t.curveHeight,ratio:v.ratio};t.isCurved?(e=[].concat(n(e),[t.navigator.makeCurvedPaths(k)]),t.addValueOverlay&&(i=[].concat(n(i),[t.navigator.makeCurvedPaths(k,!0)]))):(e=[].concat(n(e),[t.navigator.makeStraightPaths(k)]),t.addValueOverlay&&(i=[].concat(n(i),[t.navigator.makeStraightPaths(k,!0)]))),o=h,l=u,s=c}),[e,i]}},{key:"defineColorGradients",value:function(t){var e=this,i=t.append("defs");this.blocks.forEach(function(t,a){var n=t.fill.raw,r=e.colorizer.shade(n,-.2),o=i.append("linearGradient").attr({id:e.colorizer.getGradientId(a)}),l=[[0,r],[40,n],[60,n],[100,r]];l.forEach(function(t){o.append("stop").attr({offset:t[0]+"%",style:"stop-color: "+t[1]})})})}},{key:"drawTopOval",value:function(t,e){var i=0,a=this.width,n=this.width/2;this.isInverted&&(i=this.bottomLeftX,a=this.width-this.bottomLeftX);var r=e[0],o=r[1][1]+this.curveHeight-10,l=this.navigator.plot([["M",i,r[0][1]],["Q",n,o],[" ",a,r[2][1]],["M",a,10],["Q",n,0],[" ",i,10]]);t.append("path").attr("fill",this.colorizer.shade(this.blocks[0].fill.raw,-.4)).attr("d",l)}},{key:"drawBlock",value:function(t){var e=this;if(t!==this.blocks.length){var i=this.svg.append("g"),a=this.getBlockPath(i,t);this.attachData(a,this.blocks[t]);var n=null,r=this.blocks[t].fill.actual;this.addValueOverlay&&(n=this.getOverlayPath(i,t),this.attachData(n,this.blocks[t]),a.node().setAttribute("pathType","background"),n.node().setAttribute("pathType","foreground"),r=this.colorizer.shade(this.blocks[t].fill.raw,.3)),0!==this.animation?a.transition().duration(this.animation).ease("linear").attr("fill",r).attr("d",this.getPathDefinition(t)).each("end",function(){e.drawBlock(t+1)}):(a.attr("fill",r).attr("d",this.getPathDefinition(t)),this.drawBlock(t+1)),this.addValueOverlay&&(a.attr("stroke",this.blocks[t].fill.raw),0!==this.animation?n.transition().duration(this.animation).ease("linear").attr("fill",this.blocks[t].fill.actual).attr("d",this.getOverlayPathDefinition(t)):n.attr("fill",this.blocks[t].fill.actual).attr("d",this.getOverlayPathDefinition(t))),this.hoverEffects&&[a,n].forEach(function(t){t&&t.on("mouseover",e.onMouseOver).on("mouseout",e.onMouseOut)}),null!==this.onBlockClick&&[a,n].forEach(function(t){t&&t.on("click",e.onBlockClick)}),this.addBlockLabel(i,t)}}},{key:"getBlockPath",value:function(t,e){var i=t.append("path");return 0!==this.animation&&this.addBeforeTransition(i,e,!1),i}},{key:"getOverlayPath",value:function(t,e){var i=t.append("path");return 0!==this.animation&&this.addBeforeTransition(i,e,!0),i}},{key:"addBeforeTransition",value:function(t,e,i){var a=i?this.overlayPaths[e]:this.blockPaths[e],n="",r="";n=this.isCurved?this.navigator.plot([["M",a[0][0],a[0][1]],["Q",a[1][0],a[1][1]],[" ",a[2][0],a[2][1]],["L",a[2][0],a[2][1]],["M",a[2][0],a[2][1]],["Q",a[1][0],a[1][1]],[" ",a[0][0],a[0][1]]]):this.navigator.plot([["M",a[0][0],a[0][1]],["L",a[1][0],a[1][1]],["L",a[1][0],a[1][1]],["L",a[0][0],a[0][1]]]),r="solid"===this.fillType&&e>0?this.blocks[e-1].fill.actual:this.blocks[e].fill.actual,t.attr("d",n).attr("fill",r)}},{key:"attachData",value:function(t,e){var i=o({},e,{node:t.node()});t.data([i])}},{key:"getPathDefinition",value:function(t){var e=[];return this.blockPaths[t].forEach(function(t){e.push([t[2],t[0],t[1]])}),this.navigator.plot(e)}},{key:"getOverlayPathDefinition",value:function(t){var e=[];return this.overlayPaths[t].forEach(function(t){e.push([t[2],t[0],t[1]])}),this.navigator.plot(e)}},{key:"onMouseOver",value:function(t){for(var e=h["default"].event.target.parentElement.childNodes,i=0;i<e.length;i++){var a=e[i];if("path"===a.nodeName.toLowerCase()){var n=a.getAttribute("pathType")||"";"foreground"===n?h["default"].select(a).attr("fill",this.colorizer.shade(t.fill.raw,-.5)):h["default"].select(a).attr("fill",this.colorizer.shade(t.fill.raw,-.2))}}}},{key:"onMouseOut",value:function(t){for(var e=h["default"].event.target.parentElement.childNodes,i=0;i<e.length;i++){var a=e[i];if("path"===a.nodeName.toLowerCase()){var n=a.getAttribute("pathType")||"";if("background"===n){var r=this.colorizer.shade(t.fill.raw,.3);h["default"].select(a).attr("fill",r)}else h["default"].select(a).attr("fill",t.fill.actual)}}}},{key:"addBlockLabel",value:function(t,e){var i=this.blockPaths[e],a=this.blocks[e].label.formatted,n=this.blocks[e].label.color,r=this.width/2,o=this.getTextY(i),l=t.append("text").attr({x:r,y:o,fill:n,"font-size":this.label.fontSize,"text-anchor":"middle","dominant-baseline":"middle","pointer-events":"none"});null!==this.label.fontFamily&&l.attr("font-family",this.label.fontFamily),this.addLabelLines(l,a,r)}},{key:"addLabelLines",value:function(t,e,i){var a=e.split("\n"),n=20,r=-1*n*(a.length-1)/2;a.forEach(function(e,a){var o=0===a?r:n;t.append("tspan").attr({x:i,dy:o}).text(e)})}},{key:"getTextY",value:function(t){return this.isCurved?(t[2][1]+t[3][1])/2+this.curveHeight/this.blocks.length:(t[1][1]+t[2][1])/2}}]),t}();b.defaults={chart:{width:350,height:400,bottomWidth:1/3,bottomPinch:0,inverted:!1,horizontal:!1,animate:0,curve:{enabled:!1,height:20},totalCount:null},block:{dynamicHeight:!1,dynamicSlope:!1,barOverlay:!1,fill:{scale:h["default"].scale.category10().domain(h["default"].range(0,10)),type:"solid"},minHeight:0,highlight:!1},label:{fontFamily:null,fontSize:"14px",fill:"#fff",format:"{l}: {f}"},events:{click:{block:null}}},e["default"]=b},function(e,i){e.exports=t},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),n=function(){function t(){i(this,t),this.hexExpression=/^#([0-9a-f]{3}|[0-9a-f]{6})$/i,this.instanceId=null,this.labelFill=null,this.scale=null}return a(t,[{key:"setInstanceId",value:function(t){this.instanceId=t}},{key:"setLabelFill",value:function(t){this.labelFill=t}},{key:"setScale",value:function(t){this.scale=t}},{key:"getBlockFill",value:function(t,e,i,a){var n=this.getBlockRawFill(t,e);return{raw:n,actual:this.getBlockActualFill(n,e,i,a)}}},{key:"getBlockRawFill",value:function(t,e){return t.length>2&&this.hexExpression.test(t[2])?t[2]:Array.isArray(this.scale)?this.scale[e]:this.scale(e)}},{key:"getBlockActualFill",value:function(t,e,i){return"solid"===i?t:"url(#"+this.getGradientId(e)+")"}},{key:"getGradientId",value:function(t){return this.instanceId+"-gradient-"+t}},{key:"getLabelFill",value:function(t){return t.length>3&&this.hexExpression.test(t[3])?t[3]:this.labelFill}},{key:"shade",value:function(t,e){var i=t.slice(1);3===i.length&&(i=this.expandHex(i));var a=parseInt(i,16),n=0>e?0:255,r=0>e?-1*e:e,o=a>>16,l=a>>8&255,s=255&a,h=16777216+65536*(Math.round((n-o)*r)+o)+256*(Math.round((n-l)*r)+l)+(Math.round((n-s)*r)+s);return"#"+h.toString(16).slice(1)}},{key:"expandHex",value:function(t){return t[0]+t[0]+t[1]+t[1]+t[2]+t[2]}}]),t}();e["default"]=n},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),n=function(){function t(){i(this,t),this.expression=null}return a(t,[{key:"setFormat",value:function(t){"function"==typeof t?this.formatter=t:(this.expression=t,this.formatter=this.stringFormatter)}},{key:"format",value:function(t,e){return Array.isArray(e)?this.formatter(t,e[0],e[1]):this.formatter(t,e,null)}},{key:"stringFormatter",value:function(t,e){var i=arguments.length<=2||void 0===arguments[2]?null:arguments[2],a=i;return null===i&&(a=this.getDefaultFormattedValue(e)),this.expression.split("{l}").join(t).split("{v}").join(e).split("{f}").join(a)}},{key:"getDefaultFormattedValue",value:function(t){return t.toLocaleString()}}]),t}();e["default"]=n},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),n=function(){function t(){i(this,t)}return a(t,[{key:"plot",value:function(t){var e="";return t.forEach(function(t){e+=""+t[0]+t[1]+","+t[2]+" "}),e.replace(/ +/g," ").trim()}},{key:"makeCurvedPaths",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],i=this.makeBezierPoints(t);return e?this.makeBezierPath(i,t.ratio):this.makeBezierPath(i)}},{key:"makeBezierPoints",value:function(t){var e=t.centerX,i=t.prevLeftX,a=t.prevRightX,n=t.prevHeight,r=t.nextLeftX,o=t.nextRightX,l=t.nextHeight,s=t.curveHeight;return{p00:{x:i,y:n},p01:{x:e,y:n+s-10},p02:{x:a,y:n},p10:{x:r,y:l},p11:{x:e,y:l+s},p12:{x:o,y:l}}}},{key:"makeBezierPath",value:function(t){var e=t.p00,i=t.p01,a=t.p02,n=t.p10,r=t.p11,o=t.p12,l=arguments.length<=1||void 0===arguments[1]?1:arguments[1],s=this.getQuadraticBezierCurve(e,i,a,l),h=this.getQuadraticBezierCurve(n,r,o,l);return[[s.p0.x,s.p0.y,"M"],[s.p1.x,s.p1.y,"Q"],[s.p2.x,s.p2.y,""],[h.p2.x,h.p2.y,"L"],[h.p2.x,h.p2.y,"M"],[h.p1.x,h.p1.y,"Q"],[h.p0.x,h.p0.y,""],[s.p0.x,s.p0.y,"L"]]}},{key:"getQuadraticBezierCurve",value:function(t,e,i){var a=arguments.length<=3||void 0===arguments[3]?1:arguments[3];return{p0:t,p1:{x:this.getLinearInterpolation(t,e,a,"x"),y:this.getLinearInterpolation(t,e,a,"y")},p2:{x:this.getQuadraticInterpolation(t,e,i,a,"x"),y:this.getQuadraticInterpolation(t,e,i,a,"y")}}}},{key:"getLinearInterpolation",value:function(t,e,i,a){return t[a]+i*(e[a]-t[a])}},{key:"getQuadraticInterpolation",value:function(t,e,i,a,n){return Math.pow(1-a,2)*t[n]+2*(1-a)*a*e[n]+Math.pow(a,2)*i[n]}},{key:"makeStraightPaths",value:function(t){var e=t.prevLeftX,i=t.prevRightX,a=t.prevHeight,n=t.nextLeftX,r=t.nextRightX,o=t.nextHeight,l=t.ratio,s=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];if(s){var h=i-e,u=r-n,c=h*(l||0)+e,f=u*(l||0)+n;return c=Math.min(c,h),f=Math.min(f,u),[[e,a,"M"],[c,a,"L"],[f,o,"L"],[n,o,"L"],[e,a,"L"]]}return[[e,a,"M"],[i,a,"L"],[r,o,"L"],[n,o,"L"],[e,a,"L"]]}}]),t}();e["default"]=n},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},n=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),r=function(){function t(){i(this,t)}return n(t,null,[{key:"isExtendableObject",value:function(t){return"object"===("undefined"==typeof t?"undefined":a(t))&&null!==t&&!Array.isArray(t)}},{key:"extend",value:function(e,i){var a={};return Object.keys(e).length>0&&(a=t.extend({},e)),Object.keys(i).forEach(function(n){t.isExtendableObject(i[n])?t.isExtendableObject(e[n])?a[n]=t.extend(e[n],i[n]):a[n]=t.extend({},i[n]):a[n]=i[n]}),a}}]),t}();e["default"]=r}])});